load creol-interpreter
mod PROGRAM is
protecting CREOL-SIMULATOR .
op init : -> Configuration [ctor] .
eq init =
< "SantaClaus" : Cl | Inh: noInh, Par: noVid, Att: "ctReindeers" |-> null , "waitReindeers" |-> null , "harnessedReindeers" |-> null , "ctElves" |-> null , "waitElves" |-> null , "inofficeElves" |-> null, Mtds: 
  < "init" : Mtdname | Param: noVid, Latt: "_" |-> null, Code:  ( ( "ctReindeers" @@ "SantaClaus" ), ( "waitReindeers" @@ "SantaClaus" ), ( "harnessedReindeers" @@ "SantaClaus" ), ( "ctElves" @@ "SantaClaus" ), ( "waitElves" @@ "SantaClaus" ), ( "inofficeElves" @@ "SantaClaus" ) )  ::= int(0) :: list(emp) :: list(emp) :: int(0) :: list(emp) :: list(emp) ; return ( emp ) > *
  < "run" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "loop" (emp ) )  ; free( "label:0" ) ; return ( emp ) > *
  < "loop" : Mtdname | Param: noVid, Latt: "label:2" |-> null , "label:1" |-> null , "label:0" |-> null , "_" |-> null, Code: ( ( await "=" ( "ctReindeers" :: int(5) ) ) ; ( "label:0" ! "this" . "deliverToys" (emp ) )  ; ( "label:0" ? ( noVid ) )  [] ( await "&&" ( "<=" ( int(3) :: "ctElves" ) :: "~" ( "=" ( "ctReindeers" :: int(9) ) ) ) ) ; ( "label:1" ! "this" . "talkToElves" (emp ) )  ; ( "label:1" ? ( noVid ) )  ) ; ( "label:2" ! "this" . "loop" (emp ) )  ; free( "label:2" ) ; return ( emp ) > *
  < "deliverToys" : Mtdname | Param: noVid, Latt: "label:1" |-> null , "label:0" |-> null , "t1" |-> null , "t2" |-> null , "t3" |-> null , "t4" |-> null , "t5" |-> null , "_" |-> null, Code: "ctReindeers" ::= int(0) ; "t1" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" :: "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; "t2" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" :: "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; "t3" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" :: "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; "t4" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" :: "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; "t5" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" :: "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; ( await "&&" ( "&&" ( "&&" ( "&&" ( ( "t1" ?? ) :: ( "t2" ?? ) ) :: ( "t3" ?? ) ) :: ( "t4" ?? ) ) :: ( "t5" ?? ) ) ) ; free( "t5" ) ; free( "t4" ) ; free( "t3" ) ; free( "t2" ) ; free( "t1" ) ; "label:0" ! "head" ( "harnessedReindeers" ) . "unharness" ( emp ) ; free( "label:0" ) ; "harnessedReindeers" ::= "tail" ( "harnessedReindeers" ) ; "label:1" ! "head" ( "harnessedReindeers" ) . "unharness" ( emp ) ; free( "label:1" ) ; "harnessedReindeers" ::= "tail" ( "harnessedReindeers" ) ; return ( emp ) > *
  < "talkToElves" : Mtdname | Param: noVid, Latt: "t1" |-> null , "t2" |-> null , "t3" |-> null , "_" |-> null, Code: "ctElves" ::= "-" ( "ctElves" :: int(3) ) ; "t1" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" :: "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; "t2" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" :: "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; "t3" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" :: "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; ( await "&&" ( "&&" ( ( "t1" ?? ) :: ( "t2" ?? ) ) :: ( "t3" ?? ) ) ) ; free( "t3" ) ; free( "t2" ) ; free( "t1" ) ; "t1" ! "head" ( "inofficeElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; "t2" ! "head" ( "inofficeElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; "t3" ! "head" ( "inofficeElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; ( await "&&" ( "&&" ( ( "t1" ?? ) :: ( "t2" ?? ) ) :: ( "t3" ?? ) ) ) ; free( "t3" ) ; free( "t2" ) ; free( "t1" ) ; return ( emp ) > *
  < "backFromHoliday" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: "ctReindeers" ::= "+" ( "ctReindeers" :: int(1) ) ; "waitReindeers" ::= "|-" ( "waitReindeers" :: "caller" ) ; return ( emp ) > *
  < "haveProblem" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: "ctElves" ::= "+" ( "ctElves" :: int(1) ) ; "waitElves" ::= "|-" ( "waitElves" :: "caller" ) ; return ( emp ) >, Ocnt: 0 >

< "Reindeer" : Cl | Inh: noInh, Par: "sc", Att: "sc" |-> null, Mtds: 
  < "init" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "run" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "holiday" (emp ) )  ; free( "label:0" ) ; return ( emp ) > *
  < "holiday" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: "label:0" ! "sc" . "backFromHoliday" ( emp ) ; free( "label:0" ) ; return ( emp ) > *
  < "deliverToys" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "harness" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "deliverToys" (emp ) )  ; free( "label:0" ) ; return ( emp ) > *
  < "unharness" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "holiday" (emp ) )  ; free( "label:0" ) ; return ( emp ) >, Ocnt: 0 >

< "Elf" : Cl | Inh: noInh, Par: "sc", Att: "sc" |-> null, Mtds: 
  < "init" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "run" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "work" (emp ) )  ; free( "label:0" ) ; return ( emp ) > *
  < "work" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: "label:0" ! "sc" . "haveProblem" ( emp ) ; free( "label:0" ) ; return ( emp ) > *
  < "talkToSanta" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "showIn" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "talkToSanta" (emp ) )  ; free( "label:0" ) ; return ( emp ) > *
  < "showOut" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "this" . "work" (emp ) )  ; free( "label:0" ) ; return ( emp ) >, Ocnt: 0 >

< "LeaderElf" : Cl | Inh: "Elf" < emp > , Par: "sc" , "elves", Att: "sc" |-> null , "elves" |-> null, Mtds: 
  < "init" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "run" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: ( "label:0" ! "run" @ "Elf" ( emp ) )  ; ( "label:0" ? ( noVid ) )  ; return ( emp ) > *
  < "work" : Mtdname | Param: noVid, Latt: "label:0" |-> null , "_" |-> null, Code: "label:0" ! "sc" . "haveProblem" ( emp ) ; free( "label:0" ) ; return ( emp ) >, Ocnt: 0 >

< "Christmas" : Cl | Inh: noInh, Par: noVid, Att: noSubst, Mtds: 
  < "init" : Mtdname | Param: noVid, Latt: "_" |-> null, Code: skip ; return ( emp ) > *
  < "run" : Mtdname | Param: noVid, Latt: "sc" |-> null , "r" |-> null , "e" |-> null , "_" |-> null, Code: "sc" ::= new "SantaClaus" ( emp ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; return ( emp ) >, Ocnt: 0 >

.
endm
