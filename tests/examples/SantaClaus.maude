load creol-interpreter
mod PROGRAM is
pr CREOL-INTERPRETER .
op init : -> Configuration [ctor] .
eq init =
< "SantaClausC" : Cl | Inh: noInh, Par: noVid, Att: "ctRreindeers" |-> null , "waitRreindeers" |-> null , "harnessedReindeers" |-> null , "ctElves" |-> null , "waitElves" |-> null , "inofficeElves" |-> null, Mtds: 
  < "run" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "loop" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "loop" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ( await "=" ( "ctReindeers" # int(5) ) ) ; ( "sync.1" ! "this" . "deliverToys" (emp ) )  ; ( "sync.1" ? ( noVid ) )  [] ( await "&&" ( "<=" ( int(3) # "ctElves" ) # "~" ( "=" ( "ctReindeers" # int(9) ) ) ) ) ; ( "sync.0" ! "this" . "talkToElves" (emp ) )  ; ( "sync.0" ? ( noVid ) )  ) ; ( ".anon" ! "this" . "loop" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "deliverToys" : Mtdname | Param: noVid, Latt: noSubst, Code: "ctReindeers" ::= int(0) ; "t1" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" # "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; "t5" ! "head" ( "waitReindeers" ) . "harness" ( emp ) ; "harnessedReindeers" ::= "|-" ( "harnessedReindeers" # "head" ( "waitReindeers" ) ) ; "waitReindeers" ::= "tail" ( "waitReindeers" ) ; ( await "&&" ( "&&" ( "&&" ( "&&" ( ( "t1" ?? ) # ( "t2" ?? ) ) # ( "t3" ?? ) ) # ( "t4" ?? ) ) # ( "t5" ?? ) ) ) ; ".anon" ! "head" ( "harnessedReindeers" ) . "unharness" ( emp ) ; free( ".anon" ) ; "harnessedReindeers" ::= "tail" ( "harnessedReindeers" ) ; ".anon" ! "head" ( "harnessedReindeers" ) . "unharness" ( emp ) ; free( ".anon" ) ; "harnessedReindeers" ::= "tail" ( "harnessedReindeers" ) ; return ( emp ) > *
  < "talkToelves" : Mtdname | Param: noVid, Latt: noSubst, Code: "ctElves" ::= "-" ( "ctElves" # int(3) ) ; "t1" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" # "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; "t2" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" # "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; "t3" ! "head" ( "waitElves" ) . "showIn" ( emp ) ; "inofficeElves" ::= "|-" ( "inofficeElves" # "head" ( "waitElves" ) ) ; "waitElves" ::= "tail" ( "waitElves" ) ; ( await "&&" ( "&&" ( ( "t1" ?? ) # ( "t2" ?? ) ) # ( "t3" ?? ) ) ) ; "t1" ! "head" ( "inoffcieElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; "t2" ! "head" ( "inoffcieElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; "t3" ! "head" ( "inoffcieElves" ) . "showOut" ( emp ) ; "inofficeElves" ::= "tail" ( "inofficeElves" ) ; ( await "&&" ( "&&" ( ( "t1" ?? ) # ( "t2" ?? ) ) # ( "t3" ?? ) ) ) ; return ( emp ) > *
  < "backFromHoliday" : Mtdname | Param: noVid, Latt: noSubst, Code: "ctReindeers" ::= "+" ( "ctReindeers" # int(1) ) ; "waitReindeers" ::= "|-" ( "waitReindeers" # "caller" ) ; return ( emp ) > *
  < "haveProblem" : Mtdname | Param: noVid, Latt: noSubst, Code: "ctElves" ::= "+" ( "ctElves" # int(1) ) ; "waitElves" ::= "|-" ( "waitElves" # "caller" ) ; return ( emp ) >, Ocnt: 0 >

< "ReindeerC" : Cl | Inh: noInh, Par: "sc", Att: "sc" |-> null, Mtds: 
  < "run" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "holiday" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "holiday" : Mtdname | Param: noVid, Latt: noSubst, Code: ".anon" ! "sc" . "backFromHoliday" ( emp ) ; free( ".anon" ) ; return ( emp ) > *
  < "deliverToys" : Mtdname | Param: noVid, Latt: noSubst, Code: skip ; return ( emp ) > *
  < "harness" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "deliverToys" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "unharness" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "holiday" (emp ) )  ; free( ".anon" ) ; return ( emp ) >, Ocnt: 0 >

< "ElfC" : Cl | Inh: noInh, Par: "sc", Att: "sc" |-> null, Mtds: 
  < "run" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "work" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "work" : Mtdname | Param: noVid, Latt: noSubst, Code: ".anon" ! "sc" . "haveProblem" ( emp ) ; free( ".anon" ) ; return ( emp ) > *
  < "talkToSanta" : Mtdname | Param: noVid, Latt: noSubst, Code: skip ; return ( emp ) > *
  < "showIn" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "talkToSanta" (emp ) )  ; free( ".anon" ) ; return ( emp ) > *
  < "showOut" : Mtdname | Param: noVid, Latt: noSubst, Code: ( ".anon" ! "this" . "work" (emp ) )  ; free( ".anon" ) ; return ( emp ) >, Ocnt: 0 >

< "LeaderElfC" : Cl | Inh: "ElfC" < emp > , Par: "sc" , "elves", Att: "sc" |-> null , "elves" |-> null, Mtds: 
  < "run" : Mtdname | Param: noVid, Latt: noSubst, Code: ( "sync.0" ! "run" @ "ElfC" ( emp ) )  ; ( "sync.0" ? ( noVid ) )  ; return ( emp ) > *
  < "work" : Mtdname | Param: noVid, Latt: noSubst, Code: ".anon" ! "sc" . "haveProblem" ( emp ) ; free( ".anon" ) ; return ( emp ) >, Ocnt: 0 >

< "Christmas" : Cl | Inh: noInh, Par: noVid, Att: noSubst, Mtds: 
  < "run" : Mtdname | Param: noVid, Latt: "sc" |-> null , "r" |-> null , "e" |-> null, Code: "sc" ::= new "SantaClausClass" ( emp ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "r" ::= new "Reindeer" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; "e" ::= new "Elf" ( "sc" ) ; return ( emp ) >, Ocnt: 0 >

.
endm
