class Fibonacci(N:int)
begin
	op run ==
	 	var res:int;
		var t:Label;
 		t!fib(N);
	 	await t?(res)
	 	-- print("result:" + res)

	op fib(in n:int; out f:int) ==
		var a:int;
		var b:int;
		var s:Label;
		var t:Label;
		if n = 0 then f := 1 else
		if n = 1 then f := 1 else
		s!fib(n - 1);
		s?(a);
		t!fib(n - 2);
		t?(b);
		f := a + b
		fi
		fi
with any
	op fibonacci(in n:int; out f:int) ==
		var res:int;
		var t:Label;
		t!fib(n);
		t?(res);
		f := res
end

class FibTester(F: Fibonacci, N: int)
begin
	op run ==
	 	var res:int;
		var t:label;
 		t!F.fibonacci(N);
 		t?(res);
 		print("result:" + res)
end
