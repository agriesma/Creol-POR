class Fibonacci(n:Integer)
begin
	op init == skip

	op run ==
	 	var res:Integer;
 		t!fib(N);
	 	await t?(res)

	op fib(in n:Integer; out f:Integer) ==
		var a:Integer;
		var b:Integer;
		if n = 0 then f := 1 else
		if n = 1 then f := 1 else
		s!fib(n - 1);
		s?(a);
		t!fib(n - 2);
		t?(b);
		f := a + b
		fi
		fi
with Any
	op fibonacci(in n:Integer; out f:Integer) ==
		var res:Integer;
		var t:Label;
		t!fib(n);
		t?(res);
		f := res
end

class FibTester(f: Fibonacci, n: Integer)
begin
	op init == skip
	op run ==
	 	var res:Integer;
 		t!f.fibonacci(n);
 		t?(res);
end
